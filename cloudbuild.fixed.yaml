steps:
  - name: "gcr.io/cloud-builders/docker"
    args: ["build", "-t", "gcr.io/$PROJECT_ID/test-backend", "./backend"]

  - name: "gcr.io/cloud-builders/docker"
    args: ["build", "-t", "gcr.io/$PROJECT_ID/test-frontend", "./frontend"]

  - name: "gcr.io/cloud-builders/docker"
    args: ["push", "gcr.io/$PROJECT_ID/test-backend"]

  - name: "gcr.io/cloud-builders/docker"
    args: ["push", "gcr.io/$PROJECT_ID/test-frontend"]

  - name: "gcr.io/cloud-builders/gcloud"
    entrypoint: "gcloud"
    args: ["run", "deploy", "test-backend", "--image", "gcr.io/$PROJECT_ID/test-backend", "--region", "${_REGION}", "--platform", "managed", "--allow-unauthenticated", "--port", "8000"]

  - name: "gcr.io/cloud-builders/gcloud"
    entrypoint: "gcloud"
    args: ["run", "deploy", "test-frontend", "--image", "gcr.io/$PROJECT_ID/test-frontend", "--region", "${_REGION}", "--platform", "managed", "--allow-unauthenticated", "--port", "80"]

images:
  - "gcr.io/$PROJECT_ID/test-backend"
  - "gcr.io/$PROJECT_ID/test-frontend"

substitutions:
  _REGION: "us-central1"

timeout: "1200s"
